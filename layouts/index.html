<!DOCTYPE html>
{{- $defaultColor := .Site.Params.defaultColor | default "auto" -}}

{{- if eq $defaultColor "dark" -}}
<html lang="{{ .Site.LanguageCode }}" class="dark">
{{- else if eq $defaultColor "light" -}}
<html lang="{{ .Site.LanguageCode }}" class="light">
{{- else -}}
<html lang="{{ .Site.LanguageCode }}">
{{- end -}}

{{- partial "head.html" . -}}
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

<body data-theme="{{ $defaultColor }}" class="notransition">
    {{- partial "scriptsBodyStart.html" . -}}
    {{- partial "header.html" . -}}

    <div class="wrapper">
        <div class="profile-header">
            {{ partial "bio" . }}
        </div>

        <main aria-label="Content">

            {{ $media := where .Site.RegularPages "Params.type" "in" (slice "movie" "tv" "videogame" "season") }}

            {{ $mediaClean := slice }}

            {{/* Filter tv that contains seasons */}}
            {{ range $media }}
            {{ $esPadreSinFecha := false }}

            {{ if or (not (eq .Params.type "tv")) (not .Params.temporadas) (eq (len .Params.temporadas) 0) }}
            {{ $mediaClean = $mediaClean | append . }}
            {{ continue }}
            {{ end }}

            {{ if (eq .Date.Year 1) }}
            {{ $esPadreSinFecha = true }}
            {{ end }}

            {{ if not $esPadreSinFecha }}
            {{ $mediaClean = $mediaClean | append . }}
            {{ end }}
            {{ end }}

            {{ $media = $mediaClean }}

            {{ $acabados := where $media "Params.status" "eq" "Acabado" }}
            {{ $pausados := where $media "Params.status" "eq" "Pausado" }}
            {{ $abandonados := where $media "Params.status" "eq" "Abandonado" }}

            {{ $enCurso := where $media "Params.status" "not in" (slice "Acabado" "Pausado" "Abandonado" "Sin Empezar")
            }}

            {{ if gt (len $enCurso) 0 }}
            <div class="home-section">
                <h3 class="section-title"><i class="fas fa-play"></i> En Curso</h3>
                <div class="media-grid">
                    {{ range $enCurso.ByLastmod.Reverse }}
                    {{ partial "media-card.html" . }}
                    {{ end }}
                </div>
            </div>
            <hr class="section-divider">
            {{ end }}


            {{ if or (gt (len $pausados) 0) (gt (len $abandonados) 0) }}
            <div class="hidden-section-container">
                <button id="toggle-hidden-btn" onclick="toggleHiddenSection()">
                    Ver Pausados y Abandonados ({{ add (len $pausados) (len $abandonados) }})
                </button>

                <div id="hidden-content" style="display: none;">

                    {{ if gt (len $pausados) 0 }}
                    <h4 class="subsection-title">‚è∏Ô∏è Pausados</h4>
                    <div class="media-grid">
                        {{ range $pausados.ByLastmod.Reverse }}
                        {{ partial "media-card.html" . }}
                        {{ end }}
                    </div>
                    {{ end }}

                    {{ if gt (len $abandonados) 0 }}
                    <h4 class="subsection-title">üóëÔ∏è Abandonados</h4>
                    <div class="media-grid">
                        {{ range $abandonados.ByLastmod.Reverse }}
                        {{ partial "media-card.html" . }}
                        {{ end }}
                    </div>
                    {{ end }}
                </div>
            </div>
            <hr class="section-divider">
            {{ end }}


            <h3 class="section-title"><i class="fas fa-check-circle"></i>Completado</h3>

            {{ $acabadosSorted := $acabados.ByDate.Reverse }}

            {{ range $acabadosSorted.GroupByDate "2006" }}

            <div class="year-group">
                <h2 class="year-title">
                    {{ if eq .Key "0001" }}
                    No recuerdo cu√°ndo
                    {{ else }}
                    {{ .Key }}
                    {{ end }}
                </h2>
                <div class="media-grid">
                    {{ range .Pages }}
                    {{ partial "media-card.html" . }}
                    {{ end }}
                </div>
            </div>

            {{ else }}
            <p>A√∫n no hay elementos completados.</p>
            {{ end }}

        </main>
    </div>

    {{- partial "footer.html" . -}}

    <script>
        function toggleHiddenSection() {
            var content = document.getElementById("hidden-content");
            var btn = document.getElementById("toggle-hidden-btn");

            if (content.style.display === "none") {
                content.style.display = "block";
                btn.innerText = "Ocultar Pausados y Abandonados";
                btn.classList.add("active");
            } else {
                content.style.display = "none";
                btn.innerText = "Ver Pausados y Abandonados";
                btn.classList.remove("active");
            }
        }
    </script>

    {{- partial "scriptsBodyEnd.html" . -}}
</body>

</html>
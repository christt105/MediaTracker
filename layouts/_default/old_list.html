{{ define "main" }}
<div class="container">
  <h1>Mi Biblioteca de Medios</h1>

  <div class="filters-container" style="margin-bottom: 20px; padding: 10px; background: #f0f0f0; border-radius: 8px;">
      <input type="text" id="filter-search" placeholder="Buscar por título..." style="padding: 5px;">
      
      <select id="filter-year" style="padding: 5px;">
          <option value="all">Todos los años</option>
          <option value="2024">2024</option>
          <option value="2023">2023</option>
          <option value="2022">2022</option>
          </select>

       <select id="filter-type" style="padding: 5px;">
          <option value="all">Todos los tipos</option>
          <option value="movie">Películas</option>
          <option value="tv">Series</option>
          <option value="videogame">Juegos</option>
      </select>
      
      <button onclick="filterMedia()">Aplicar Filtros</button>
      </div>


  <div class="media-grid" id="media-grid-container">
    {{/* Iteramos sobre las páginas de la sección "media" */}}
    {{ range where .Site.RegularPages "Params.type" "in" (slice "movie" "tv" "videogame") }}
      
      {{ $tags_str := "" }}
      {{ if .Params.tags }}{{ $tags_str = delimit .Params.tags "," }}{{ end }}

      <div class="media-card" 
           data-title="{{ lower .Title }}" 
           data-year="{{ .Params.year }}" 
           data-type="{{ .Params.type }}"
           data-tags="{{ lower $tags_str }}">

        <div class="media-poster">
            <a href="{{ .Permalink }}">
                {{ $img := .Params.cover | default "/images/default-poster.png" }}
                <img src="{{ $img }}" alt="{{ .Title }}" loading="lazy">
            </a>
            {{ if .Params.fa_icon }}
            <div class="media-type-icon">
                <i class="{{ .Params.fa_icon }}"></i>
            </div>
            {{ end }}
        </div>
        <div class="media-info">
            <h3><a href="{{ .Permalink }}">{{ .Title }}</a></h3>
            <small>{{ .Params.year }} </small>
        </div>
      </div>
    {{ else }}
      <p>No hay contenido multimedia todavía.</p>
    {{ end }}
  </div>
</div>

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

<script>
function filterMedia() {
    const searchInput = document.getElementById('filter-search').value.toLowerCase();
    const yearSelect = document.getElementById('filter-year').value;
    const typeSelect = document.getElementById('filter-type').value;
    
    const cards = document.querySelectorAll('.media-card');

    cards.forEach(card => {
        const title = card.getAttribute('data-title');
        const year = card.getAttribute('data-year');
        const type = card.getAttribute('data-type');
        // const tags = card.getAttribute('data-tags'); // Para futuro uso

        let isMatch = true;

        // Filtro de Texto
        if (searchInput && !title.includes(searchInput)) isMatch = false;
        // Filtro de Año
        if (yearSelect !== 'all' && year !== yearSelect) isMatch = false;
        // Filtro de Tipo
        if (typeSelect !== 'all' && type !== typeSelect) isMatch = false;

        if (isMatch) {
            card.style.display = 'block';
        } else {
            card.style.display = 'none';
        }
    });
}

// Opcional: Filtrar al escribir en vivo
document.getElementById('filter-search').addEventListener('keyup', filterMedia);
</script>

{{ end }}